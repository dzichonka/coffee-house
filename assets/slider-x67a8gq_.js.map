{"version":3,"file":"slider-x67a8gq_.js","sources":["../../src/scripts/modules/slider.ts"],"sourcesContent":["import { fetcher } from \"@/scripts/utils/fetcher\";\n\nconst slideWrapper: HTMLDivElement | null =\n  document.querySelector(\".slider-wrapper\");\nconst wrapper: HTMLDivElement | null = document.querySelector(\".wrapper\");\nconst sliderDiv: HTMLDivElement | null = document.querySelector(\".slider\");\nconst dotsContainer: HTMLDivElement | null = document.querySelector(\".dots\");\n\nconst prev: HTMLButtonElement | null = document.querySelector(\".prev\");\nconst next: HTMLButtonElement | null = document.querySelector(\".next\");\n\nconst errorDiv: HTMLDivElement | null = document.querySelector(\"#error\");\nconst refreshButton: HTMLButtonElement | null =\n  document.querySelector(\"#refresh\");\n\nexport async function initSlider(): Promise<void> {\n  if (!slideWrapper || !dotsContainer) return;\n\n  slideWrapper!.innerHTML = \"\";\n  dotsContainer!.innerHTML = \"\";\n\n  const { data: res, error } = await fetcher<{\n    data: FavoriteProduct[];\n    message?: string;\n    error?: string;\n  }>(\n    \"https://6kt29kkeub.execute-api.eu-central-1.amazonaws.com/products/favorites\",\n    \"#loader\"\n  );\n\n  if (error) {\n    if (sliderDiv) sliderDiv.style.display = \"none\";\n    if (dotsContainer) dotsContainer.style.display = \"none\";\n    if (errorDiv) errorDiv.style.display = \"flex\";\n\n    return;\n  }\n\n  const slides = res?.data ?? [];\n\n  slides.forEach((slide, index) => {\n    const div: HTMLDivElement = document.createElement(\"div\");\n    div.classList.add(\"slide\");\n    if (index === 0) div.classList.add(\"active\");\n\n    div.innerHTML = `\n      <img src=\"images/favourites/${slide.id}.png\" alt=\"${slide.name}\">\n      <h3>${slide.name}</h3>\n      <p>${slide.description}</p>\n      <h3>$${slide.price}</h3>\n    `;\n\n    slideWrapper.append(div);\n\n    const dot: HTMLDivElement = document.createElement(\"div\");\n    dot.classList.add(\"dot\");\n    dot.appendChild(document.createElement(\"span\"));\n    dotsContainer.appendChild(dot);\n  });\n\n  const slidesArray: HTMLDivElement[] = Array.from(\n    document.querySelectorAll(\".slide\")\n  );\n  const dots: HTMLDivElement[] = Array.from(\n    dotsContainer.querySelectorAll(\".dot\")\n  );\n\n  let currentIndex = 0;\n  let autoScrollDelay = 5000;\n  let autoScrollTimer: null | ReturnType<typeof setTimeout> = null;\n\n  let progressRAF: number | null = null;\n  let progressStartTime: number | null = null;\n  let progressElapsed = 0;\n\n  function updateProgress(dot: Element): void {\n    const bar: HTMLSpanElement | null = dot.querySelector(\"span\");\n    if (!dot) return;\n    if (progressRAF) cancelAnimationFrame(progressRAF);\n\n    function step(timestamp: number): void {\n      if (!bar) {\n        return;\n      }\n      if (!progressStartTime) progressStartTime = timestamp;\n      const delta = timestamp - progressStartTime + progressElapsed;\n      const percent = Math.min((delta / autoScrollDelay) * 100, 100);\n      if (bar) bar.style.width = percent + \"%\";\n\n      if (percent < 100) {\n        progressRAF = requestAnimationFrame(step);\n      } else {\n        progressStartTime = null;\n        progressElapsed = 0;\n        progressStartTime = null;\n      }\n    }\n    progressRAF = requestAnimationFrame(step);\n  }\n\n  function stopProgress(): void {\n    if (progressRAF) cancelAnimationFrame(progressRAF);\n    if (progressStartTime) {\n      progressElapsed += performance.now() - progressStartTime;\n    }\n    progressStartTime = null;\n  }\n\n  function resetProgress(): void {\n    if (progressRAF) cancelAnimationFrame(progressRAF);\n    dots.forEach((d) => {\n      const span = d.querySelector(\"span\");\n      if (span) span.style.width = \"0%\";\n    });\n    progressElapsed = 0;\n    progressStartTime = null;\n  }\n\n  function showSlide(index: number): void {\n    slidesArray.forEach((s, i) => s.classList.toggle(\"active\", i === index));\n\n    resetProgress();\n    updateProgress(dots[index]);\n  }\n\n  function startAutoScroll() {\n    stopAutoScroll();\n    autoScrollTimer = setTimeout(() => {\n      currentIndex = (currentIndex + 1) % slides.length;\n      showSlide(currentIndex);\n      startAutoScroll();\n    }, autoScrollDelay - progressElapsed);\n  }\n\n  function stopAutoScroll(): void {\n    if (autoScrollTimer) clearTimeout(autoScrollTimer);\n  }\n\n  prev?.addEventListener(\"click\", (): void => {\n    currentIndex = (currentIndex - 1 + slides.length) % slides.length;\n    showSlide(currentIndex);\n    startAutoScroll();\n  });\n\n  next?.addEventListener(\"click\", () => {\n    currentIndex = (currentIndex + 1) % slides.length;\n    showSlide(currentIndex);\n    startAutoScroll();\n  });\n\n  wrapper?.addEventListener(\"mouseenter\", () => {\n    stopAutoScroll();\n    stopProgress();\n  });\n  wrapper?.addEventListener(\"mouseleave\", () => {\n    startAutoScroll();\n    updateProgress(dots[currentIndex]);\n  });\n\n  let startX = 0;\n\n  wrapper?.addEventListener(\"touchstart\", (e: Event): void => {\n    stopAutoScroll();\n    stopProgress();\n\n    if (!(e instanceof TouchEvent)) return;\n    const touch = e.touches[0];\n    startX = touch.clientX;\n  });\n\n  wrapper?.addEventListener(\"touchend\", (e: Event) => {\n    if (!(e instanceof TouchEvent)) return;\n    const endX = e.changedTouches[0].clientX;\n    const diff = endX - startX;\n\n    if (diff > 50)\n      currentIndex = (currentIndex - 1 + slides.length) % slides.length;\n    else if (diff < -50) currentIndex = (currentIndex + 1) % slides.length;\n    showSlide(currentIndex);\n    resetProgress();\n    startAutoScroll();\n  });\n\n  showSlide(currentIndex);\n  startAutoScroll();\n}\n\ninitSlider();\n\nrefreshButton?.addEventListener(\"click\", () => {\n  initSlider();\n  if (sliderDiv) sliderDiv.style.display = \"flex\";\n  if (dotsContainer) dotsContainer.style.display = \"flex\";\n  if (errorDiv) errorDiv.style.display = \"none\";\n});\n"],"names":["slideWrapper","wrapper","sliderDiv","dotsContainer","prev","next","errorDiv","refreshButton","initSlider","res","error","fetcher","slides","slide","index","div","dot","slidesArray","dots","currentIndex","autoScrollDelay","autoScrollTimer","progressRAF","progressStartTime","progressElapsed","updateProgress","bar","step","timestamp","delta","percent","stopProgress","resetProgress","d","span","showSlide","s","i","startAutoScroll","stopAutoScroll","startX","diff"],"mappings":"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"}