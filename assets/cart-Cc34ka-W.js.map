{"version":3,"file":"cart-Cc34ka-W.js","sources":["../../src/scripts/components/Cart/renderCart.ts","../../src/scripts/components/Cart/removeItem.ts","../../src/scripts/components/Cart/hendleConfirm.ts","../../src/scripts/modules/cart.ts"],"sourcesContent":["import { useCartState } from \"../../state/cartState\";\nimport { useUserState } from \"../../state/userState\";\nimport { addCartIcon } from \"../../utils/addCartIcon\";\n\nconst { isLoggedIn } = useUserState();\n\nconst { getCart, getTotalPriceNew, getTotalPriceOld } = useCartState();\n\nexport function renderCart(removeFn: (e: Event) => void) {\n  const cartList: HTMLUListElement | null =\n    document.querySelector(\"#cart-list\");\n  const totalPriceOldDiv: HTMLHeadingElement | null =\n    document.querySelector(\"#total-price-old\");\n  const totalPriceNewDiv: HTMLHeadingElement | null =\n    document.querySelector(\"#total-price-new\");\n\n  if (\n    !(cartList instanceof HTMLUListElement) ||\n    !(totalPriceOldDiv instanceof HTMLHeadingElement) ||\n    !(totalPriceNewDiv instanceof HTMLHeadingElement)\n  ) {\n    throw new Error(\"Cart elements not found\");\n  }\n\n  const cartItems = getCart();\n\n  cartList.innerHTML = \"\";\n  cartItems.forEach((item) => {\n    for (let i = 0; i < item.quantity; i++) {\n      const li = document.createElement(\"li\");\n      li.classList.add(\"cart-item\");\n\n      const removeBtn = document.createElement(\"button\");\n      removeBtn.setAttribute(\"data-id\", item.productId.toString());\n      removeBtn.classList.add(\"btn-icon\");\n      removeBtn.type = \"button\";\n      removeBtn.innerHTML = `<img src=\"icons/trash.svg\" alt=\"trash icon\" />`;\n      removeBtn.addEventListener(\"click\", removeFn);\n\n      const img = document.createElement(\"img\");\n      img.classList.add(\"cart-item_img\");\n      img.src = `/images/menu/${item.productId}.png`;\n      img.alt = item.name;\n\n      const infoDiv = document.createElement(\"div\");\n      infoDiv.classList.add(\"cart-item_info\");\n\n      const title = document.createElement(\"h3\");\n      title.classList.add(\"cart-item_name\");\n      title.textContent = item.name;\n\n      const description = document.createElement(\"p\");\n\n      const size = document.createElement(\"span\");\n      size.classList.add(\"cart-item_size\");\n      size.textContent = item.size;\n\n      const additives = document.createElement(\"span\");\n      additives.classList.add(\"cart-item_additives\");\n      additives.textContent = item.additives.join(\", \");\n\n      description.append(size, additives);\n      infoDiv.append(title, description);\n\n      const priceDiv = document.createElement(\"div\");\n      priceDiv.classList.add(\"price-container\");\n\n      if (isLoggedIn()) {\n        const priceOld = document.createElement(\"h3\");\n        priceOld.classList.add(\"price__old\");\n        priceOld.textContent = `$${item.priceOld.toFixed(2)}`;\n\n        const priceNew = document.createElement(\"h3\");\n        priceNew.textContent = `$${(item.priceOld - item.priceNew).toFixed(2)}`;\n\n        totalPriceOldDiv.textContent = `$${getTotalPriceOld().toFixed(2)}`;\n        totalPriceNewDiv.textContent = `$${(getTotalPriceOld() - getTotalPriceNew()).toFixed(2)}`;\n\n        priceDiv.append(priceOld, priceNew);\n      } else {\n        const priceNew = document.createElement(\"h3\");\n        priceNew.classList.add(\"price__new\");\n        priceNew.textContent = `$${item.priceOld.toFixed(2)}`;\n\n        totalPriceNewDiv.textContent = `$${getTotalPriceOld().toFixed(2)}`;\n\n        priceDiv.append(priceNew);\n      }\n\n      li.append(removeBtn, img, infoDiv, priceDiv);\n\n      cartList?.append(li);\n    }\n  });\n\n  addCartIcon();\n}\n","import { useCartState } from \"../../state/cartState\";\nimport { renderCart } from \"../../components/Cart/renderCart\";\n\nconst { getCart, setCart } = useCartState();\n\nexport const removeItem = (e: Event) => {\n  const target = e.target;\n  if (!(target instanceof Element)) return;\n\n  const btn = target.closest<HTMLButtonElement>(\"button[data-id]\");\n  if (!btn) return;\n\n  const idStr = btn.getAttribute(\"data-id\");\n  if (!idStr) return;\n  const idNum = Number(idStr);\n\n  const cart = getCart();\n  const idx = cart.findIndex((item) => item.productId === idNum);\n  if (idx === -1) return;\n\n  const newCart = [...cart];\n\n  if (newCart[idx].quantity > 1) {\n    newCart[idx] = { ...newCart[idx], quantity: newCart[idx].quantity - 1 };\n  } else {\n    newCart.splice(idx, 1);\n  }\n\n  setCart(newCart);\n  renderCart(removeItem);\n};\n","import { fetcher } from \"../../utils/fetcher\";\nimport { useCartState } from \"../../state/cartState\";\n\nconst { getCart, getTotalPriceNew, getTotalPriceOld, clear } = useCartState();\n\nconst price = getTotalPriceOld() - getTotalPriceNew();\n\nconst cart: CartItem[] = getCart();\n\nconst items: Item[] = cart.map(({ productId, size, additives, quantity }) => ({\n  productId,\n  size,\n  additives,\n  quantity,\n}));\n\nconst oder: Order = {\n  items,\n  totalPrice: price,\n};\n\nconst errorDiv: HTMLHeadingElement | null = document.querySelector(\"#error\");\nconst cartList: HTMLUListElement | null = document.querySelector(\"#cart-list\");\nif (\n  !(errorDiv instanceof HTMLHeadingElement) ||\n  !(cartList instanceof HTMLUListElement)\n) {\n  throw new Error(\"Elements not found\");\n}\n\nexport const handleConfim = async () => {\n  errorDiv.classList.add(\"hidden\");\n  const { data: res, error } = await fetcher<\n    {\n      data: OrderResponse;\n      message?: string;\n      error?: string;\n    },\n    Order\n  >(\n    \"https://6kt29kkeub.execute-api.eu-central-1.amazonaws.com/orders/confirm\",\n    \"#loader\",\n    {\n      method: \"POST\",\n      body: oder,\n    }\n  );\n\n  if (error) {\n    if (errorDiv) errorDiv.classList.remove(\"hidden\");\n    return;\n  }\n\n  if (res) {\n    clear();\n    if (cartList)\n      cartList.innerHTML = `            <h3 id=\"message\" class=\"message\">\n              Thank you for your order! Our manager will contact you shortly.\n            </h3>`;\n    if (errorDiv) errorDiv.classList.add(\"hidden\");\n  }\n};\n","import { removeItem } from \"../components/Cart/removeItem\";\nimport { useUserState } from \"../state/userState\";\nimport { fetcher } from \"../utils/fetcher\";\nimport { renderCart } from \"../components/Cart/renderCart\";\nimport { handleConfim } from \"../components/Cart/hendleConfirm\";\n\nconst { isLoggedIn, getToken } = useUserState();\n\nconst buttonsDiv: HTMLDivElement | null = document.querySelector(\".buttons\");\nconst userInfoDiv: HTMLDivElement | null =\n  document.querySelector(\"#cart-total\");\n\nif (\n  !(buttonsDiv instanceof HTMLDivElement) ||\n  !(userInfoDiv instanceof HTMLDivElement)\n)\n  throw new Error(\"Cart list not found\");\n\nif (isLoggedIn()) {\n  const { data: res, error } = await fetcher<{\n    data: User;\n    message?: string;\n    error?: string;\n  }>(\n    \"https://6kt29kkeub.execute-api.eu-central-1.amazonaws.com/auth/profile\",\n    \"#loader\",\n    {\n      headers: {\n        Accept: \"application/json\",\n        Authorization: `Bearer ${getToken()}`,\n      },\n    }\n  );\n\n  if (error) {\n    if (buttonsDiv) {\n      buttonsDiv.innerHTML = \"error\";\n    }\n  }\n\n  const user = res?.data;\n\n  if (!user) {\n    throw new Error(\"User not found\");\n  }\n\n  const address = document.createElement(\"div\");\n  address.classList.add(\"cart-row\");\n  address.innerHTML = `<h3>Address:</h3>\n                      <h3>${user.city}, ${user.street}, ${user.houseNumber}</h3>`;\n\n  const payment = document.createElement(\"div\");\n  payment.classList.add(\"cart-row\");\n  payment.innerHTML = `<h3>Pay by:</h3>\n                      <h3>${user.paymentMethod.charAt(0).toUpperCase() + user.paymentMethod.slice(1)}</h3>`;\n\n  userInfoDiv.append(address, payment);\n\n  const confirmBtn = document.createElement(\"button\");\n  confirmBtn.classList.add(\"btn\");\n  confirmBtn.type = \"button\";\n  confirmBtn.innerHTML = \"Confirm\";\n  buttonsDiv.appendChild(confirmBtn);\n\n  confirmBtn.addEventListener(\"click\", handleConfim);\n}\n\nif (!isLoggedIn()) {\n  const loginBtn = document.createElement(\"a\");\n  loginBtn.classList.add(\"btn\");\n  loginBtn.innerHTML = \"Login\";\n  loginBtn.href = \"login\";\n\n  const registerBtn = document.createElement(\"a\");\n  registerBtn.classList.add(\"btn\");\n  registerBtn.innerHTML = \"Registration\";\n  registerBtn.href = \"registration\";\n\n  buttonsDiv.append(loginBtn, registerBtn);\n}\n\nrenderCart(removeItem);\n"],"names":["isLoggedIn","useUserState","getCart","getTotalPriceNew","getTotalPriceOld","useCartState","renderCart","removeFn","cartList","totalPriceOldDiv","totalPriceNewDiv","cartItems","item","i","li","removeBtn","img","infoDiv","title","description","size","additives","priceDiv","priceOld","priceNew","addCartIcon","setCart","removeItem","e","target","btn","idStr","idNum","cart","idx","newCart","clear","price","items","productId","quantity","oder","errorDiv","handleConfim","res","error","fetcher","getToken","buttonsDiv","userInfoDiv","user","address","payment","confirmBtn","loginBtn","registerBtn"],"mappings":"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"}