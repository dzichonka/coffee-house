import{u as d,a as T}from"./addCartIcon-Bo9DjT4J.js";import{u as b}from"./userState-C2crR08W.js";import{a as $,d as D,c as q,u as I,g as N,o as O}from"./firebase-8-SqUyFW.js";import{l as P}from"./user-CjhoEeDW.js";const{isLoggedIn:_}=b(),{getTotalPriceNew:w,getTotalPriceOld:m}=d(),f=document.querySelector("#total-price-old"),h=document.querySelector("#total-price-new");function H(){if(!(f instanceof HTMLHeadingElement)||!(h instanceof HTMLHeadingElement))throw new Error("Cart elements not found");_()?(m()===w()?f.classList.add("hidden"):f.classList.remove("hidden"),f.textContent=`$${m().toFixed(2)}`,h.textContent=`$${(m()-w()).toFixed(2)}`):h.textContent=`$${m().toFixed(2)}`}const{isLoggedIn:U}=b(),{getCart:F}=d();function x(r){const e=document.querySelector("#cart-list");if(!(e instanceof HTMLUListElement))throw new Error("Cart elements not found");const n=F();e.innerHTML="",n.forEach(t=>{for(let o=0;o<t.quantity;o++){const i=document.createElement("li");i.classList.add("cart-item");const s=document.createElement("button");s.setAttribute("data-id",t.productId.toString()),s.classList.add("btn-icon"),s.type="button",s.innerHTML='<i class="fa-solid fa-trash"></i>',s.addEventListener("click",r);const a=document.createElement("img");a.classList.add("cart-item_img"),a.src=`/images/menu/${t.productId}.png`,a.alt=t.name;const l=document.createElement("div");l.classList.add("cart-item_info");const p=document.createElement("h3");p.classList.add("cart-item_name"),p.textContent=t.name;const y=document.createElement("p"),L=document.createElement("span");L.classList.add("cart-item_size"),L.textContent=t.size;const g=document.createElement("span");g.classList.add("cart-item_additives"),g.textContent=t.additives.length?t.additives.map(c=>`, ${c}`).join(""):"",y.append(L,g),l.append(p,y);const u=document.createElement("div");if(u.classList.add("price-container"),U()){const c=document.createElement("h3");c.classList.add("price__old"),c.textContent=`$${t.priceOld.toFixed(2)}`;const v=document.createElement("h3");v.textContent=`$${(t.priceOld-t.priceNew).toFixed(2)}`,u.append(c,v)}else{const c=document.createElement("h3");c.classList.add("price__new"),c.textContent=`$${t.priceOld.toFixed(2)}`,u.append(c)}i.append(s,a,l,u),e?.append(i)}}),H(),T()}const{getTotalCount:A}=d();function C(){const r=document.querySelector("#confirm");if(r)if(A()>0){r.disabled=!1,r.classList.remove("disabled");return}else{r.disabled=!0,r.classList.add("disabled");return}}const{getCart:B,setCart:k}=d(),M=r=>{const e=r.target;if(!(e instanceof Element))return;const n=e.closest("button[data-id]");if(!n)return;const t=n.getAttribute("data-id");if(!t)return;const o=Number(t),i=B(),s=i.findIndex(l=>l.productId===o);if(s===-1)return;const a=[...i];a[s].quantity>1?a[s]={...a[s],quantity:a[s].quantity-1}:a.splice(s,1),k(a),C(),x(M)},{clear:z}=d(),R=async r=>{const e=$.currentUser;if(!e){console.error("User not authenticated");return}const n=document.querySelector("#error"),t=document.querySelector("#cart-list");if(!(n instanceof HTMLHeadingElement)||!(t instanceof HTMLUListElement))throw new Error("Elements not found");try{n.classList.add("hidden");const o=D(q,"users",e.uid);await I(o,{orders:N({...r,createdAt:new Date().toISOString()})}),z(),t&&(t.innerHTML=`<h3 id="message" class="message">
              Thank you for your order! Our manager will contact you shortly.
            </h3>`),n&&n.classList.add("hidden"),T(),H(),C()}catch(o){console.error("Error saving order:",o),n?.classList.remove("hidden")}},{getTotalPriceOld:j,getTotalPriceNew:G,getCart:J}=d(),E=document.querySelector(".buttons"),S=document.querySelector("#cart-total");if(!(E instanceof HTMLDivElement)||!(S instanceof HTMLDivElement))throw new Error("Cart list not found");const K=j()-G(),Q=J(),V=Q.map(({productId:r,size:e,additives:n,quantity:t})=>({productId:r,size:e,additives:n,quantity:t})),W={items:V,totalPrice:K};O($,async r=>{if(r){const e=await P();if(!e){console.error("No user data found in Firestore");return}const n=document.createElement("div");n.classList.add("cart-row"),n.innerHTML=`<h3>Address:</h3>
                      <h3>${e.city}, ${e.street}, ${e.houseNumber}</h3>`;const t=document.createElement("div");t.classList.add("cart-row"),t.innerHTML=`<h3>Pay by:</h3>
                      <h3>${e.paymentMethod.charAt(0).toUpperCase()+e.paymentMethod.slice(1)}</h3>`,S.append(n,t);const o=document.createElement("button");o.classList.add("btn"),o.id="confirm",o.type="button",o.innerHTML="Confirm",E.appendChild(o),C(),o.addEventListener("click",()=>{R(W)})}else{const e=document.createElement("a");e.classList.add("btn"),e.innerHTML="Login",e.href="login";const n=document.createElement("a");n.classList.add("btn"),n.innerHTML="Registration",n.href="registration",E.append(e,n)}});x(M);
//# sourceMappingURL=cart-x_5HWC1W.js.map
