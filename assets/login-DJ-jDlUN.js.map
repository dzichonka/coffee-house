{"version":3,"file":"login-DJ-jDlUN.js","sources":["../../src/scripts/modules/login.ts"],"sourcesContent":["import { fetcher } from \"../utils/fetcher\";\nimport { useUserState } from \"../state/userState\";\nimport { validateLogin, validatePassword } from \"../utils/validation\";\n\nconst { setToken } = useUserState();\n\nconst form: HTMLFormElement | null = document.querySelector(\"#login-form\");\nconst loginInput: HTMLInputElement | null | undefined =\n  form?.querySelector(\"#login\");\nconst passwordInput: HTMLInputElement | null | undefined =\n  form?.querySelector(\"#password\");\nconst loginButton: HTMLButtonElement | null | undefined =\n  form?.querySelector(\"#login-btn\");\n\nif (\n  !(form instanceof HTMLFormElement) ||\n  !(loginInput instanceof HTMLInputElement) ||\n  !(passwordInput instanceof HTMLInputElement) ||\n  !(loginButton instanceof HTMLButtonElement)\n) {\n  throw new Error(\"Login form elements not found\");\n}\n\nloginButton.disabled = true;\n\nfunction handleValidation(\n  input: HTMLInputElement,\n  validateFn: (value: string) => string | null\n) {\n  const errorSpan = input.nextElementSibling;\n\n  if (!(errorSpan instanceof HTMLSpanElement) || !errorSpan) {\n    throw new Error(\"Error span not found\");\n  }\n\n  input.addEventListener(\"blur\", () => {\n    const error = validateFn(input.value);\n    if (error) {\n      input.classList.add(\"invalid\");\n      errorSpan.textContent = error;\n      errorSpan.classList.add(\"active\");\n    } else {\n      input.classList.add(\"valid\");\n    }\n\n    updateButtonState();\n  });\n\n  input.addEventListener(\"focus\", () => {\n    input.classList.remove(\"invalid\");\n    input.classList.remove(\"valid\");\n    errorSpan.textContent = \"\";\n    errorSpan.classList.remove(\"active\");\n  });\n}\n\nfunction updateButtonState() {\n  if (!loginInput || !passwordInput || !loginButton) return;\n  const loginError = validateLogin(loginInput.value);\n  const passwordError = validatePassword(passwordInput.value);\n  loginButton.disabled = !!loginError || !!passwordError;\n}\n\nhandleValidation(loginInput, validateLogin);\nhandleValidation(passwordInput, validatePassword);\n\nloginButton.addEventListener(\"click\", async (e) => {\n  e.preventDefault();\n  if (form.querySelector(\".alert-error\")) {\n    form.querySelector(\".alert-error\")?.remove();\n  }\n  if (!loginInput || !passwordInput) return;\n\n  const payload = {\n    login: loginInput.value,\n    password: passwordInput.value,\n  };\n\n  const { data: res, error } = await fetcher<\n    {\n      data: LoginResponse;\n      message?: string;\n      error?: string;\n    },\n    LoginPayload\n  >(\n    \"https://6kt29kkeub.execute-api.eu-central-1.amazonaws.com/auth/login\",\n    \"#loader\",\n    {\n      method: \"POST\",\n      body: payload,\n    }\n  );\n\n  if (error) {\n    const alert = document.createElement(\"div\");\n    alert.className = \"alert-error\";\n    alert.textContent = `Incorrect login or password`;\n    form.append(alert);\n  }\n  if (res && res.data) {\n    setToken(res.data.access_token);\n    window.location.href = \"index\";\n  }\n});\n"],"names":["setToken","useUserState","form","loginInput","passwordInput","loginButton","handleValidation","input","validateFn","errorSpan","error","updateButtonState","loginError","validateLogin","passwordError","validatePassword","payload","res","fetcher","alert"],"mappings":"qIAIA,KAAM,CAAE,SAAAA,CAAA,EAAaC,EAAA,EAEfC,EAA+B,SAAS,cAAc,aAAa,EACnEC,EACJD,GAAM,cAAc,QAAQ,EACxBE,EACJF,GAAM,cAAc,WAAW,EAC3BG,EACJH,GAAM,cAAc,YAAY,EAElC,GACE,EAAEA,aAAgB,kBAClB,EAAEC,aAAsB,mBACxB,EAAEC,aAAyB,mBAC3B,EAAEC,aAAuB,mBAEzB,MAAM,IAAI,MAAM,+BAA+B,EAGjDA,EAAY,SAAW,GAEvB,SAASC,EACPC,EACAC,EACA,CACA,MAAMC,EAAYF,EAAM,mBAExB,GAAI,EAAEE,aAAqB,kBAAoB,CAACA,EAC9C,MAAM,IAAI,MAAM,sBAAsB,EAGxCF,EAAM,iBAAiB,OAAQ,IAAM,CACnC,MAAMG,EAAQF,EAAWD,EAAM,KAAK,EAChCG,GACFH,EAAM,UAAU,IAAI,SAAS,EAC7BE,EAAU,YAAcC,EACxBD,EAAU,UAAU,IAAI,QAAQ,GAEhCF,EAAM,UAAU,IAAI,OAAO,EAG7BI,EAAA,CACF,CAAC,EAEDJ,EAAM,iBAAiB,QAAS,IAAM,CACpCA,EAAM,UAAU,OAAO,SAAS,EAChCA,EAAM,UAAU,OAAO,OAAO,EAC9BE,EAAU,YAAc,GACxBA,EAAU,UAAU,OAAO,QAAQ,CACrC,CAAC,CACH,CAEA,SAASE,GAAoB,CAC3B,GAAI,CAACR,GAAc,CAACC,GAAiB,CAACC,EAAa,OACnD,MAAMO,EAAaC,EAAcV,EAAW,KAAK,EAC3CW,EAAgBC,EAAiBX,EAAc,KAAK,EAC1DC,EAAY,SAAW,CAAC,CAACO,GAAc,CAAC,CAACE,CAC3C,CAEAR,EAAiBH,EAAYU,CAAa,EAC1CP,EAAiBF,EAAeW,CAAgB,EAEhDV,EAAY,iBAAiB,QAAS,MAAO,GAAM,CAKjD,GAJA,EAAE,eAAA,EACEH,EAAK,cAAc,cAAc,GACnCA,EAAK,cAAc,cAAc,GAAG,OAAA,EAElC,CAACC,GAAc,CAACC,EAAe,OAEnC,MAAMY,EAAU,CACd,MAAOb,EAAW,MAClB,SAAUC,EAAc,KAAA,EAGpB,CAAE,KAAMa,EAAK,MAAAP,CAAA,EAAU,MAAMQ,EAQjC,uEACA,UACA,CACE,OAAQ,OACR,KAAMF,CAAA,CACR,EAGF,GAAIN,EAAO,CACT,MAAMS,EAAQ,SAAS,cAAc,KAAK,EAC1CA,EAAM,UAAY,cAClBA,EAAM,YAAc,8BACpBjB,EAAK,OAAOiB,CAAK,CACnB,CACIF,GAAOA,EAAI,OACbjB,EAASiB,EAAI,KAAK,YAAY,EAC9B,OAAO,SAAS,KAAO,QAE3B,CAAC"}