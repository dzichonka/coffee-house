import{u,a as P}from"./addCartIcon-y838yzLs.js";import{u as T}from"./userState-BenL3nAi.js";import{f as x}from"./fetcher-IzjmCLXP.js";const{isLoggedIn:k}=T(),{getTotalPriceNew:$,getTotalPriceOld:p}=u(),L=document.querySelector("#total-price-old"),C=document.querySelector("#total-price-new");function H(){if(!(L instanceof HTMLHeadingElement)||!(C instanceof HTMLHeadingElement))throw new Error("Cart elements not found");k()?(p()===$()?L.classList.add("hidden"):L.classList.remove("hidden"),L.textContent=`$${p().toFixed(2)}`,C.textContent=`$${(p()-$()).toFixed(2)}`):C.textContent=`$${p().toFixed(2)}`}const{isLoggedIn:N}=T(),{getCart:O}=u();function M(t){const n=document.querySelector("#cart-list");if(!(n instanceof HTMLUListElement))throw new Error("Cart elements not found");const o=O();n.innerHTML="",o.forEach(e=>{for(let c=0;c<e.quantity;c++){const r=document.createElement("li");r.classList.add("cart-item");const s=document.createElement("button");s.setAttribute("data-id",e.productId.toString()),s.classList.add("btn-icon"),s.type="button",s.innerHTML='<img src="icons/trash.svg" alt="trash icon" />',s.addEventListener("click",t);const a=document.createElement("img");a.classList.add("cart-item_img"),a.src=`/images/menu/${e.productId}.png`,a.alt=e.name;const l=document.createElement("div");l.classList.add("cart-item_info");const g=document.createElement("h3");g.classList.add("cart-item_name"),g.textContent=e.name;const b=document.createElement("p"),h=document.createElement("span");h.classList.add("cart-item_size"),h.textContent=e.size;const E=document.createElement("span");E.classList.add("cart-item_additives"),E.textContent=e.additives.join(", "),b.append(h,E),l.append(g,b);const f=document.createElement("div");if(f.classList.add("price-container"),N()){const i=document.createElement("h3");i.classList.add("price__old"),i.textContent=`$${e.priceOld.toFixed(2)}`;const v=document.createElement("h3");v.textContent=`$${(e.priceOld-e.priceNew).toFixed(2)}`,f.append(i,v)}else{const i=document.createElement("h3");i.classList.add("price__new"),i.textContent=`$${e.priceOld.toFixed(2)}`,f.append(i)}r.append(s,a,l,f),n?.append(r)}}),H(),P()}const{getTotalCount:D}=u();function y(){const t=document.querySelector("#confirm");if(t)if(D()>0){t.disabled=!1,t.classList.remove("disabled");return}else{t.disabled=!0,t.classList.add("disabled");return}}const{getCart:_,setCart:z}=u(),I=t=>{const n=t.target;if(!(n instanceof Element))return;const o=n.closest("button[data-id]");if(!o)return;const e=o.getAttribute("data-id");if(!e)return;const c=Number(e),r=_(),s=r.findIndex(l=>l.productId===c);if(s===-1)return;const a=[...r];a[s].quantity>1?a[s]={...a[s],quantity:a[s].quantity-1}:a.splice(s,1),z(a),y(),M(I)},{getCart:A,getTotalPriceNew:B,getTotalPriceOld:F,clear:U}=u(),j=F()-B(),R=A(),G=R.map(({productId:t,size:n,additives:o,quantity:e})=>({productId:t,size:n,additives:o,quantity:e})),J={items:G,totalPrice:j},d=document.querySelector("#error"),w=document.querySelector("#cart-list");if(!(d instanceof HTMLHeadingElement)||!(w instanceof HTMLUListElement))throw new Error("Elements not found");const K=async()=>{d.classList.add("hidden");const{data:t,error:n}=await x("https://6kt29kkeub.execute-api.eu-central-1.amazonaws.com/orders/confirm","#loader",{method:"POST",body:J});if(n){d&&d.classList.remove("hidden");return}t&&(U(),w&&(w.innerHTML=`<h3 id="message" class="message">
              Thank you for your order! Our manager will contact you shortly.
            </h3>`),d&&d.classList.add("hidden"),H(),y())},{isLoggedIn:S,getToken:Q}=T(),m=document.querySelector(".buttons"),q=document.querySelector("#cart-total");if(!(m instanceof HTMLDivElement)||!(q instanceof HTMLDivElement))throw new Error("Cart list not found");if(S()){const{data:t,error:n}=await x("https://6kt29kkeub.execute-api.eu-central-1.amazonaws.com/auth/profile","#loader",{headers:{Accept:"application/json",Authorization:`Bearer ${Q()}`}});n&&m&&(m.innerHTML="error");const o=t?.data;if(!o)throw new Error("User not found");const e=document.createElement("div");e.classList.add("cart-row"),e.innerHTML=`<h3>Address:</h3>
                      <h3>${o.city}, ${o.street}, ${o.houseNumber}</h3>`;const c=document.createElement("div");c.classList.add("cart-row"),c.innerHTML=`<h3>Pay by:</h3>
                      <h3>${o.paymentMethod.charAt(0).toUpperCase()+o.paymentMethod.slice(1)}</h3>`,q.append(e,c);const r=document.createElement("button");r.classList.add("btn"),r.id="confirm",r.type="button",r.innerHTML="Confirm",m.appendChild(r),y(),r.addEventListener("click",K)}if(!S()){const t=document.createElement("a");t.classList.add("btn"),t.innerHTML="Login",t.href="login";const n=document.createElement("a");n.classList.add("btn"),n.innerHTML="Registration",n.href="registration",m.append(t,n)}M(I);
//# sourceMappingURL=cart-BNtv4Gc4.js.map
