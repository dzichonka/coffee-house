{"version":3,"file":"registration-CD7oUkaa.js","sources":["../../src/scripts/modules/registration.ts"],"sourcesContent":["import {\n  validateLogin,\n  validatePassword,\n  validateConfirmPassword,\n  validateSelect,\n  validateHouseNumber,\n} from \"../utils/validation\";\nimport { fetcher } from \"../utils/fetcher\";\n\nconst form: HTMLFormElement | null =\n  document.querySelector(\"#registration-form\");\nconst loginInput: HTMLInputElement | null | undefined =\n  form?.querySelector(\"#login\");\nconst passwordInput: HTMLInputElement | null | undefined =\n  form?.querySelector(\"#password\");\nconst confirmPasswordInput: HTMLInputElement | null | undefined =\n  form?.querySelector(\"#confirm-password\");\nconst citySelect: HTMLSelectElement | null | undefined =\n  form?.querySelector(\"#city\");\nconst streetSelect: HTMLSelectElement | null | undefined =\n  form?.querySelector(\"#street\");\nconst houseNumberInput: HTMLInputElement | null | undefined =\n  form?.querySelector(\"#houseNumber\");\nconst paymentMethodRadios = document.querySelectorAll<HTMLInputElement>(\n  'input[name=\"paymentMethod\"]',\n);\nconst registrationButton: HTMLButtonElement | null | undefined =\n  form?.querySelector(\"#login-btn\");\n\nif (\n  !(form instanceof HTMLFormElement) ||\n  !(loginInput instanceof HTMLInputElement) ||\n  !(passwordInput instanceof HTMLInputElement) ||\n  !(confirmPasswordInput instanceof HTMLInputElement) ||\n  !(citySelect instanceof HTMLSelectElement) ||\n  !(streetSelect instanceof HTMLSelectElement) ||\n  !(houseNumberInput instanceof HTMLInputElement) ||\n  paymentMethodRadios.length === 0 ||\n  !(registrationButton instanceof HTMLButtonElement)\n) {\n  throw new Error(\"Registration form elements not found\");\n}\n\nasync function getCities(): Promise<Record<string, string[]>> {\n  const response = await fetch(\"assets/cities.json\");\n  return await response.json();\n}\n\nfunction makeCityOptions(cities: Record<string, string[]>): void {\n  Object.keys(cities).forEach((city) => {\n    const option = document.createElement(\"option\");\n    option.value = city;\n    option.textContent = city;\n    citySelect?.appendChild(option);\n  });\n}\n\nfunction makeStreetOptions(city: string[]): void {\n  streetSelect!.innerHTML = \"\";\n  const placeholder = document.createElement(\"option\");\n  placeholder.value = \"\";\n  placeholder.textContent = \"Select street\";\n  placeholder.disabled = true;\n  placeholder.selected = true;\n  streetSelect!.appendChild(placeholder);\n  if (!city) return;\n  city.map((street) => {\n    const option = document.createElement(\"option\");\n    option.value = street;\n    option.textContent = street;\n    streetSelect?.append(option);\n  });\n}\n\nconst cities = await getCities();\nmakeCityOptions(cities);\ncitySelect?.addEventListener(\"change\", () => {\n  const selectedCity = citySelect.value;\n  makeStreetOptions(cities[selectedCity] || null);\n});\n\nregistrationButton.disabled = true;\n\nfunction handleValidation(\n  input: HTMLInputElement | HTMLSelectElement,\n  validateFn: (value: string) => string | null,\n) {\n  const errorSpan = input.nextElementSibling;\n\n  if (!(errorSpan instanceof HTMLSpanElement) || !errorSpan) {\n    throw new Error(\"Error span not found\");\n  }\n\n  input.addEventListener(\"blur\", () => {\n    const error = validateFn(input.value);\n    if (error) {\n      input.classList.add(\"invalid\");\n      errorSpan.textContent = error;\n      errorSpan.classList.add(\"active\");\n    } else {\n      input.classList.add(\"valid\");\n    }\n    updateButtonState();\n  });\n\n  input.addEventListener(\"focus\", () => {\n    input.classList.remove(\"invalid\");\n    input.classList.remove(\"valid\");\n    errorSpan.textContent = \"\";\n    errorSpan.classList.remove(\"active\");\n  });\n}\n\nfunction updateButtonState() {\n  if (\n    !loginInput ||\n    !passwordInput ||\n    !confirmPasswordInput ||\n    !citySelect ||\n    !streetSelect ||\n    !houseNumberInput ||\n    !registrationButton\n  )\n    return;\n  const loginError = validateLogin(loginInput.value);\n  const passwordError = validatePassword(passwordInput.value);\n  const confirmPasswordError = validateConfirmPassword(\n    passwordInput.value,\n    confirmPasswordInput.value,\n  );\n  const cityError = validateSelect(citySelect.value);\n  const streetError = validateSelect(streetSelect.value);\n  const houseNumberError = validateHouseNumber(houseNumberInput.value);\n  registrationButton.disabled =\n    !!loginError ||\n    !!passwordError ||\n    !!confirmPasswordError ||\n    !!cityError ||\n    !!streetError ||\n    !!houseNumberError;\n}\n\nhandleValidation(loginInput, validateLogin);\nhandleValidation(passwordInput, validatePassword);\nhandleValidation(confirmPasswordInput, () =>\n  validateConfirmPassword(passwordInput.value, confirmPasswordInput.value),\n);\nhandleValidation(streetSelect, validateSelect);\nhandleValidation(citySelect, validateSelect);\nhandleValidation(houseNumberInput, validateHouseNumber);\n\nregistrationButton.addEventListener(\"click\", async (e) => {\n  e.preventDefault();\n  if (form.querySelector(\".alert-error\")) {\n    form.querySelector(\".alert-error\")?.remove();\n  }\n\n  const payload: RegistrationResponse = {\n    login: loginInput.value,\n    password: passwordInput.value,\n    confirmPassword: confirmPasswordInput.value,\n    city: citySelect.value,\n    street: streetSelect.value,\n    houseNumber: Number(houseNumberInput.value),\n    paymentMethod:\n      String(\n        Array.from(paymentMethodRadios).find((radio) => radio.checked)?.value,\n      ) || \"\",\n  };\n\n  const { data: res, error } = await fetcher<\n    {\n      data: RegistrationResponse;\n      message?: string;\n      error?: string;\n    },\n    LoginPayload\n  >(\n    \"https://6kt29kkeub.execute-api.eu-central-1.amazonaws.com/auth/register\",\n    \"#loader\",\n    {\n      method: \"POST\",\n      body: payload,\n    },\n  );\n  const alert = document.createElement(\"div\");\n  alert.className = \"alert-error\";\n  if (error) {\n    alert.textContent = `Incorrect login or password`;\n    form.append(alert);\n  }\n  if (res) {\n    alert.textContent = `Registration successful! You can now sign in.`;\n    form.append(alert);\n  }\n});\n"],"names":["form","loginInput","passwordInput","confirmPasswordInput","citySelect","streetSelect","houseNumberInput","paymentMethodRadios","registrationButton","getCities","makeCityOptions","cities","city","option","makeStreetOptions","placeholder","street","selectedCity","handleValidation","input","validateFn","errorSpan","error","updateButtonState","loginError","validateLogin","passwordError","validatePassword","confirmPasswordError","validateConfirmPassword","cityError","validateSelect","streetError","houseNumberError","validateHouseNumber","payload","radio","res","fetcher","alert"],"mappings":"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"}