{"version":3,"file":"cart-DzF62wqv.js","sources":["../../src/scripts/components/Cart/refreshTotal.ts","../../src/scripts/components/Cart/renderCart.ts","../../src/scripts/components/Cart/disabledConfirm.ts","../../src/scripts/components/Cart/removeItem.ts","../../src/scripts/components/Cart/hendleConfirm.ts","../../src/scripts/modules/cart.ts"],"sourcesContent":["import { useCartState } from \"../../state/cartState\";\nimport { useUserState } from \"../../state/userState\";\n\nconst { isLoggedIn } = useUserState();\n\nconst { getTotalPriceNew, getTotalPriceOld } = useCartState();\n\nconst totalPriceOldDiv: HTMLHeadingElement | null =\n  document.querySelector(\"#total-price-old\");\nconst totalPriceNewDiv: HTMLHeadingElement | null =\n  document.querySelector(\"#total-price-new\");\n\nexport function refreshTotal(): void {\n  if (\n    !(totalPriceOldDiv instanceof HTMLHeadingElement) ||\n    !(totalPriceNewDiv instanceof HTMLHeadingElement)\n  ) {\n    throw new Error(\"Cart elements not found\");\n  }\n  if (isLoggedIn()) {\n    if (getTotalPriceOld() === getTotalPriceNew()) {\n      totalPriceOldDiv.classList.add(\"hidden\");\n    } else {\n      totalPriceOldDiv.classList.remove(\"hidden\");\n    }\n    totalPriceOldDiv.textContent = `$${getTotalPriceOld().toFixed(2)}`;\n    totalPriceNewDiv.textContent = `$${(getTotalPriceOld() - getTotalPriceNew()).toFixed(2)}`;\n  } else {\n    totalPriceNewDiv.textContent = `$${getTotalPriceOld().toFixed(2)}`;\n  }\n}\n","import { useCartState } from \"../../state/cartState\";\nimport { useUserState } from \"../../state/userState\";\nimport { addCartIcon } from \"../../utils/addCartIcon\";\nimport { refreshTotal } from \"./refreshTotal\";\n\nconst { isLoggedIn } = useUserState();\n\nconst { getCart } = useCartState();\n\nexport function renderCart(removeFn: (e: Event) => void) {\n  const cartList: HTMLUListElement | null =\n    document.querySelector(\"#cart-list\");\n\n  if (!(cartList instanceof HTMLUListElement)) {\n    throw new Error(\"Cart elements not found\");\n  }\n\n  const cartItems = getCart();\n\n  cartList.innerHTML = \"\";\n  cartItems.forEach((item) => {\n    for (let i = 0; i < item.quantity; i++) {\n      const li = document.createElement(\"li\");\n      li.classList.add(\"cart-item\");\n\n      const removeBtn = document.createElement(\"button\");\n      removeBtn.setAttribute(\"data-id\", item.productId.toString());\n      removeBtn.classList.add(\"btn-icon\");\n      removeBtn.type = \"button\";\n      removeBtn.innerHTML = `<i class=\"fa-solid fa-trash\"></i>`;\n      removeBtn.addEventListener(\"click\", removeFn);\n\n      const img = document.createElement(\"img\");\n      img.classList.add(\"cart-item_img\");\n      img.src = `/images/menu/${item.productId}.png`;\n      img.alt = item.name;\n\n      const infoDiv = document.createElement(\"div\");\n      infoDiv.classList.add(\"cart-item_info\");\n\n      const title = document.createElement(\"h3\");\n      title.classList.add(\"cart-item_name\");\n      title.textContent = item.name;\n\n      const description = document.createElement(\"p\");\n\n      const size = document.createElement(\"span\");\n      size.classList.add(\"cart-item_size\");\n      size.textContent = item.size;\n\n      const additives = document.createElement(\"span\");\n      additives.classList.add(\"cart-item_additives\");\n      additives.textContent = item.additives.length\n        ? item.additives.map((a) => `, ${a}`).join(\"\")\n        : \"\";\n\n      description.append(size, additives);\n      infoDiv.append(title, description);\n\n      const priceDiv = document.createElement(\"div\");\n      priceDiv.classList.add(\"price-container\");\n\n      if (isLoggedIn()) {\n        const priceOld = document.createElement(\"h3\");\n        priceOld.classList.add(\"price__old\");\n        priceOld.textContent = `$${item.priceOld.toFixed(2)}`;\n\n        const priceNew = document.createElement(\"h3\");\n        priceNew.textContent = `$${(item.priceOld - item.priceNew).toFixed(2)}`;\n\n        // totalPriceOldDiv.textContent = `$${getTotalPriceOld().toFixed(2)}`;\n        // totalPriceNewDiv.textContent = `$${(getTotalPriceOld() - getTotalPriceNew()).toFixed(2)}`;\n\n        priceDiv.append(priceOld, priceNew);\n      } else {\n        const priceNew = document.createElement(\"h3\");\n        priceNew.classList.add(\"price__new\");\n        priceNew.textContent = `$${item.priceOld.toFixed(2)}`;\n\n        //totalPriceNewDiv.textContent = `$${getTotalPriceOld().toFixed(2)}`;\n\n        priceDiv.append(priceNew);\n      }\n\n      li.append(removeBtn, img, infoDiv, priceDiv);\n\n      cartList?.append(li);\n    }\n  });\n  refreshTotal();\n  addCartIcon();\n}\n","import { useCartState } from \"../../state/cartState\";\n\nconst { getTotalCount } = useCartState();\n\nexport function disabledConfirm() {\n  const confirmBtn = document.querySelector<HTMLButtonElement>(\"#confirm\");\n  if (!confirmBtn) return;\n\n  if (getTotalCount() > 0) {\n    confirmBtn.disabled = false;\n    confirmBtn.classList.remove(\"disabled\");\n    return;\n  } else {\n    confirmBtn.disabled = true;\n    confirmBtn.classList.add(\"disabled\");\n    return;\n  }\n}\n","import { useCartState } from \"../../state/cartState\";\nimport { renderCart } from \"../../components/Cart/renderCart\";\nimport { refreshTotal } from \"./refreshTotal\";\nimport { disabledConfirm } from \"./disabledConfirm\";\n\nconst { getCart, setCart } = useCartState();\n\nexport const removeItem = (e: Event) => {\n  const target = e.target;\n  if (!(target instanceof Element)) return;\n\n  const btn = target.closest<HTMLButtonElement>(\"button[data-id]\");\n  if (!btn) return;\n\n  const idStr = btn.getAttribute(\"data-id\");\n  if (!idStr) return;\n  const idNum = Number(idStr);\n\n  const cart = getCart();\n  const idx = cart.findIndex((item) => item.productId === idNum);\n  if (idx === -1) return;\n\n  const newCart = [...cart];\n\n  if (newCart[idx].quantity > 1) {\n    newCart[idx] = { ...newCart[idx], quantity: newCart[idx].quantity - 1 };\n  } else {\n    newCart.splice(idx, 1);\n  }\n  setCart(newCart);\n  disabledConfirm();\n  renderCart(removeItem);\n};\n","//import { fetcher } from \"../../utils/fetcher\";\nimport { useCartState } from \"../../state/cartState\";\nimport { refreshTotal } from \"./refreshTotal\";\nimport { disabledConfirm } from \"./disabledConfirm\";\nimport { addCartIcon } from \"@/scripts/utils/addCartIcon\";\nimport { auth, db } from \"@/firebase\";\nimport { doc, updateDoc, arrayUnion } from \"firebase/firestore\";\n\nconst { clear } = useCartState();\n\nexport const handleConfim = async (order: Order) => {\n  const user = auth.currentUser;\n  if (!user) {\n    console.error(\"User not authenticated\");\n    return;\n  }\n\n  const errorDiv: HTMLHeadingElement | null = document.querySelector(\"#error\");\n  const cartList: HTMLUListElement | null =\n    document.querySelector(\"#cart-list\");\n  if (\n    !(errorDiv instanceof HTMLHeadingElement) ||\n    !(cartList instanceof HTMLUListElement)\n  ) {\n    throw new Error(\"Elements not found\");\n  }\n  try {\n    errorDiv.classList.add(\"hidden\");\n\n    const userDocRef = doc(db, \"users\", user.uid);\n\n    await updateDoc(userDocRef, {\n      orders: arrayUnion({\n        ...order,\n        createdAt: new Date().toISOString(),\n      }),\n    });\n\n    clear();\n    if (cartList)\n      cartList.innerHTML = `<h3 id=\"message\" class=\"message\">\n              Thank you for your order! Our manager will contact you shortly.\n            </h3>`;\n    if (errorDiv) errorDiv.classList.add(\"hidden\");\n    addCartIcon();\n    refreshTotal();\n    disabledConfirm();\n  } catch (error) {\n    console.error(\"Error saving order:\", error);\n    errorDiv?.classList.remove(\"hidden\");\n  }\n};\n","import { removeItem } from \"../components/Cart/removeItem\";\nimport { renderCart } from \"../components/Cart/renderCart\";\nimport { handleConfim } from \"../components/Cart/hendleConfirm\";\nimport { disabledConfirm } from \"../components/Cart/disabledConfirm\";\nimport { loadUserData } from \"../api/user\";\nimport { onAuthStateChanged } from \"firebase/auth\";\nimport { auth } from \"@/firebase\";\nimport { useCartState } from \"@/scripts/state/cartState\";\n\nconst { getTotalPriceOld, getTotalPriceNew, getCart } = useCartState();\n\nconst buttonsDiv: HTMLDivElement | null = document.querySelector(\".buttons\");\nconst userInfoDiv: HTMLDivElement | null =\n  document.querySelector(\"#cart-total\");\n\nif (\n  !(buttonsDiv instanceof HTMLDivElement) ||\n  !(userInfoDiv instanceof HTMLDivElement)\n)\n  throw new Error(\"Cart list not found\");\n\nconst price = getTotalPriceOld() - getTotalPriceNew();\n\nconst cart: CartItem[] = getCart();\n\nconst items: Item[] = cart.map(\n  ({ productId, name, size, additives, quantity }) => ({\n    productId,\n    name,\n    size,\n    additives,\n    quantity,\n  })\n);\n\nconst order: Order = {\n  items,\n  totalPrice: price,\n};\n\nonAuthStateChanged(auth, async (user) => {\n  if (user) {\n    const userData = await loadUserData();\n\n    if (!userData) {\n      console.error(\"No user data found in Firestore\");\n      return;\n    }\n\n    const userName = document.createElement(\"div\");\n    userName.classList.add(\"cart-row\");\n    userName.innerHTML = `<h3>Name:</h3>\n                      <h3>${userData.login}</h3>`;\n\n    const address = document.createElement(\"div\");\n    address.classList.add(\"cart-row\");\n    address.innerHTML = `<h3>Address:</h3>\n                      <h3>${userData.city}, ${userData.street}, ${userData.houseNumber}</h3>`;\n\n    const payment = document.createElement(\"div\");\n    payment.classList.add(\"cart-row\");\n    payment.innerHTML = `<h3>Pay by:</h3>\n                      <h3>${userData.paymentMethod.charAt(0).toUpperCase() + userData.paymentMethod.slice(1)}</h3>`;\n\n    userInfoDiv.append(userName, address, payment);\n\n    const confirmBtn = document.createElement(\"button\");\n    confirmBtn.classList.add(\"btn\");\n    confirmBtn.id = \"confirm\";\n    confirmBtn.type = \"button\";\n    confirmBtn.innerHTML = \"Confirm\";\n    buttonsDiv.appendChild(confirmBtn);\n    disabledConfirm();\n\n    confirmBtn.addEventListener(\"click\", () => {\n      handleConfim(order);\n    });\n  } else {\n    const loginBtn = document.createElement(\"a\");\n    loginBtn.classList.add(\"btn\");\n    loginBtn.innerHTML = \"Login\";\n    loginBtn.href = \"login\";\n\n    const registerBtn = document.createElement(\"a\");\n    registerBtn.classList.add(\"btn\");\n    registerBtn.innerHTML = \"Registration\";\n    registerBtn.href = \"registration\";\n\n    buttonsDiv.append(loginBtn, registerBtn);\n  }\n});\n\nrenderCart(removeItem);\n"],"names":["isLoggedIn","useUserState","getTotalPriceNew","getTotalPriceOld","useCartState","totalPriceOldDiv","totalPriceNewDiv","refreshTotal","getCart","renderCart","removeFn","cartList","cartItems","item","i","li","removeBtn","img","infoDiv","title","description","size","additives","a","priceDiv","priceOld","priceNew","addCartIcon","getTotalCount","disabledConfirm","confirmBtn","setCart","removeItem","e","target","btn","idStr","idNum","cart","idx","newCart","clear","handleConfim","order","user","auth","errorDiv","userDocRef","doc","db","updateDoc","arrayUnion","error","buttonsDiv","userInfoDiv","price","items","productId","name","quantity","onAuthStateChanged","userData","loadUserData","userName","address","payment","loginBtn","registerBtn"],"mappings":"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"}