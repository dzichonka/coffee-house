{"version":3,"file":"addCartIcon-Bo9DjT4J.js","sources":["../../src/scripts/state/cartState.ts","../../src/scripts/utils/addCartIcon.ts"],"sourcesContent":["type CartState = {\n  items: CartItem[];\n  totalPriceOld: number;\n  totalPriceNew: number;\n};\n\nconst STORAGE_KEY = \"cartState\";\n\nfunction loadFromLocalStorage(): CartState {\n  const saved = localStorage.getItem(STORAGE_KEY);\n  if (saved) return JSON.parse(saved);\n  return { items: [], totalPriceOld: 0, totalPriceNew: 0 };\n}\n\nfunction saveToLocalStorage(state: CartState): void {\n  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));\n}\n\nlet state: CartState = loadFromLocalStorage();\n\nfunction recalcTotals() {\n  state.totalPriceOld = state.items.reduce(\n    (sum, item) => sum + item.priceOld * item.quantity,\n    0,\n  );\n  state.totalPriceNew = state.items.reduce(\n    (sum, item) => sum + item.priceNew * item.quantity,\n    0,\n  );\n}\n\nfunction addItem(newItem: CartItem) {\n  const existing = state.items.find(\n    (item) =>\n      item.productId === newItem.productId &&\n      item.size === newItem.size &&\n      JSON.stringify(item.additives) === JSON.stringify(newItem.additives),\n  );\n\n  if (existing) {\n    existing.quantity += newItem.quantity;\n  } else {\n    state.items.push(newItem);\n  }\n\n  recalcTotals();\n  saveToLocalStorage(state);\n}\n\nfunction clear() {\n  state = { items: [], totalPriceOld: 0, totalPriceNew: 0 };\n  saveToLocalStorage(state);\n}\n\nfunction getCart(): CartItem[] {\n  return state.items;\n}\nfunction setCart(items: CartItem[]): void {\n  state.items = items;\n  recalcTotals();\n  saveToLocalStorage(state);\n}\n\nfunction getTotalPriceOld(): number {\n  return state.totalPriceOld;\n}\n\nfunction getTotalPriceNew(): number {\n  return state.totalPriceNew;\n}\n\nfunction getTotalCount(): number {\n  return state.items.reduce((sum, item) => sum + item.quantity, 0);\n}\n\nexport function useCartState() {\n  return {\n    addItem,\n    clear,\n    getCart,\n    setCart,\n    getTotalPriceOld,\n    getTotalPriceNew,\n    getTotalCount,\n  };\n}\n","import { onAuthStateChanged } from \"firebase/auth\";\nimport { useCartState } from \"../state/cartState\";\nimport { auth } from \"@/firebase\";\n\nconst { getTotalCount } = useCartState();\n\nexport function addCartIcon() {\n  const wrapper = document.querySelector<HTMLDivElement>(\"#nav-right\");\n  if (!wrapper) return;\n\n  onAuthStateChanged(auth, (user) => {\n    const count = getTotalCount();\n    const cartLink = wrapper.querySelector<HTMLAnchorElement>(\".link-cart\");\n    const oldCount = Number(\n      cartLink?.querySelector<HTMLSpanElement>(\"span\")?.textContent || 0\n    );\n    if (user || count > 0) {\n      if (!cartLink) {\n        const newLink = document.createElement(\"a\");\n        newLink.classList.add(\"btn-icon\", \"link-cart\");\n        newLink.href = \"cart\";\n        newLink.innerHTML = `\n        <i class=\"fa-solid fa-bag-shopping\"></i>\n        <span>${count > 0 ? count : \"\"}</span>\n      `;\n        wrapper.prepend(newLink);\n      } else if (oldCount !== count) {\n        const span = cartLink.querySelector(\"span\");\n        if (span) span.textContent = count > 0 ? String(count) : \"\";\n      }\n    } else if (cartLink) {\n      cartLink.remove();\n    }\n  });\n}\n"],"names":["STORAGE_KEY","loadFromLocalStorage","saved","saveToLocalStorage","state","recalcTotals","sum","item","addItem","newItem","existing","clear","getCart","setCart","items","getTotalPriceOld","getTotalPriceNew","getTotalCount","useCartState","addCartIcon","wrapper","onAuthStateChanged","auth","user","count","cartLink","oldCount","span","newLink"],"mappings":"kDAMA,MAAMA,EAAc,YAEpB,SAASC,GAAkC,CACzC,MAAMC,EAAQ,aAAa,QAAQF,CAAW,EAC9C,OAAIE,EAAc,KAAK,MAAMA,CAAK,EAC3B,CAAE,MAAO,CAAA,EAAI,cAAe,EAAG,cAAe,CAAA,CACvD,CAEA,SAASC,EAAmBC,EAAwB,CAClD,aAAa,QAAQJ,EAAa,KAAK,UAAUI,CAAK,CAAC,CACzD,CAEA,IAAIA,EAAmBH,EAAA,EAEvB,SAASI,GAAe,CACtBD,EAAM,cAAgBA,EAAM,MAAM,OAChC,CAACE,EAAKC,IAASD,EAAMC,EAAK,SAAWA,EAAK,SAC1C,CAAA,EAEFH,EAAM,cAAgBA,EAAM,MAAM,OAChC,CAACE,EAAKC,IAASD,EAAMC,EAAK,SAAWA,EAAK,SAC1C,CAAA,CAEJ,CAEA,SAASC,EAAQC,EAAmB,CAClC,MAAMC,EAAWN,EAAM,MAAM,KAC1BG,GACCA,EAAK,YAAcE,EAAQ,WAC3BF,EAAK,OAASE,EAAQ,MACtB,KAAK,UAAUF,EAAK,SAAS,IAAM,KAAK,UAAUE,EAAQ,SAAS,CAAA,EAGnEC,EACFA,EAAS,UAAYD,EAAQ,SAE7BL,EAAM,MAAM,KAAKK,CAAO,EAG1BJ,EAAA,EACAF,EAAmBC,CAAK,CAC1B,CAEA,SAASO,GAAQ,CACfP,EAAQ,CAAE,MAAO,CAAA,EAAI,cAAe,EAAG,cAAe,CAAA,EACtDD,EAAmBC,CAAK,CAC1B,CAEA,SAASQ,GAAsB,CAC7B,OAAOR,EAAM,KACf,CACA,SAASS,EAAQC,EAAyB,CACxCV,EAAM,MAAQU,EACdT,EAAA,EACAF,EAAmBC,CAAK,CAC1B,CAEA,SAASW,GAA2B,CAClC,OAAOX,EAAM,aACf,CAEA,SAASY,GAA2B,CAClC,OAAOZ,EAAM,aACf,CAEA,SAASa,GAAwB,CAC/B,OAAOb,EAAM,MAAM,OAAO,CAACE,EAAKC,IAASD,EAAMC,EAAK,SAAU,CAAC,CACjE,CAEO,SAASW,GAAe,CAC7B,MAAO,CACL,QAAAV,EACA,MAAAG,EACA,QAAAC,EACA,QAAAC,EACA,iBAAAE,EACA,iBAAAC,EAAA,cACAC,CAAA,CAEJ,CCjFA,KAAM,CAAE,cAAAA,CAAA,EAAkBC,EAAA,EAEnB,SAASC,GAAc,CAC5B,MAAMC,EAAU,SAAS,cAA8B,YAAY,EAC9DA,GAELC,EAAmBC,EAAOC,GAAS,CACjC,MAAMC,EAAQP,EAAA,EACRQ,EAAWL,EAAQ,cAAiC,YAAY,EAChEM,EAAW,OACfD,GAAU,cAA+B,MAAM,GAAG,aAAe,CAAA,EAEnE,GAAIF,GAAQC,EAAQ,EAClB,GAAKC,GASL,GAAWC,IAAaF,EAAO,CAC7B,MAAMG,EAAOF,EAAS,cAAc,MAAM,EACtCE,IAAMA,EAAK,YAAcH,EAAQ,EAAI,OAAOA,CAAK,EAAI,GAC3D,MAZe,CACb,MAAMI,EAAU,SAAS,cAAc,GAAG,EAC1CA,EAAQ,UAAU,IAAI,WAAY,WAAW,EAC7CA,EAAQ,KAAO,OACfA,EAAQ,UAAY;AAAA;AAAA,gBAEZJ,EAAQ,EAAIA,EAAQ,EAAE;AAAA,QAE9BJ,EAAQ,QAAQQ,CAAO,CACzB,MAISH,GACTA,EAAS,OAAA,CAEb,CAAC,CACH"}