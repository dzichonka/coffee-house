import{f as M}from"./fetcher-IzjmCLXP.js";import{u as E}from"./userState-C2crR08W.js";import{u as T,a as w}from"./addCartIcon-Bo9DjT4J.js";import"./firebase-8-SqUyFW.js";const{isLoggedIn:H}=E();function k(e){const s=document.querySelector("#modal-sizes");if(!(s instanceof HTMLDivElement))return;s.innerHTML="",Object.keys(e.sizes).forEach((t,r)=>{const i=e.sizes[t],o=document.createElement("button");o.classList.add("tab","tab-size","tooltip"),r===0&&o.classList.add("active"),o.setAttribute("data-price",i.price??"0"),o.setAttribute("data-discount",i.discountPrice||i.price||"0"),o.setAttribute("data-size-key",i.size);const a=document.createElement("span");a.classList.add("sign"),a.textContent=t.toUpperCase();const d=document.createElement("span");d.classList.add("text"),d.textContent=i.size;const l=document.createElement("span");l.classList.add("tooltip-text"),H()?i.discountPrice?l.innerHTML=`
        <span class="old-price">$${i.price}</span>
        <span class="new-price">$${i.discountPrice??i.price}</span>
      `:l.innerHTML=`
        <span class="new-price">$${i.price}</span>
      `:l.textContent=`$${i.price}`,o.append(a,d,l),s.append(o)})}const{isLoggedIn:A}=E();function N(e){const s=document.querySelector("#modal-additives");if(!(s instanceof HTMLDivElement))return;s.innerHTML="",e.additives.map((t,r)=>{const i=document.createElement("button");i.classList.add("tab","tab-add","tooltip"),i.setAttribute("data-add-price",t.price??"0"),i.setAttribute("data-add-discount",t.discountPrice||t.price||"0"),i.setAttribute("data-add-key",t.name);const o=document.createElement("span");o.classList.add("sign"),o.textContent=String(r+1);const a=document.createElement("span");a.classList.add("text"),a.textContent=t.name;const d=document.createElement("span");d.classList.add("tooltip-text"),A()?t.discountPrice?d.innerHTML=`
        <span class="old-price">$${t.price}</span>
        <span class="new-price">$${t.discountPrice??t.price}</span>
      `:d.innerHTML=`
          <span class="new-price">$${t.price}</span>
        `:d.textContent=`$${t.price}`,i.append(o,a,d),s.append(i)})}let n={productId:0,name:"",sizeKey:"",sizePrice:"0",sizeDiscount:"0",addKeys:[],addPrice:"0",addDiscounts:"0",totalPrice:0,totalDiscount:0};function f(){const e=Number(n.sizePrice)||0,s=Number(n.sizeDiscount)||0,c=Number(n.addPrice)||0,t=Number(n.addDiscounts)||0;n.totalPrice=+(e+c).toFixed(2),n.totalDiscount=+(s+t).toFixed(2)}function C(){return{...n}}function I(e){n={...n,...e},f()}function K(e){n.sizeKey=e.size,n.sizePrice=e.price,n.sizeDiscount=e.discountPrice??e.price,f()}function h(e){n.addKeys.includes(e.name)?(n.addKeys=n.addKeys.filter(c=>c!==e.name),n.addPrice=(Number(n.addPrice)-Number(e.price)).toFixed(2),n.addDiscounts=(Number(n.addDiscounts)-Number(e.discountPrice??e.price)).toFixed(2)):(n.addKeys.push(e.name),n.addPrice=(Number(n.addPrice)+Number(e.price)).toFixed(2),n.addDiscounts=(Number(n.addDiscounts)+Number(e.discountPrice??e.price)).toFixed(2)),f()}function q(e,s,c){n.addKeys.includes(e)&&(n.addKeys=n.addKeys.filter(t=>t!==e),n.addPrice=(Number(n.addPrice)-Number(s)).toFixed(2),n.addDiscounts=(Number(n.addDiscounts)-Number(c??s)).toFixed(2),f())}function F(){n={productId:0,name:"",sizeKey:"",sizePrice:"0",sizeDiscount:"0",addKeys:[],addPrice:"0",addDiscounts:"0",totalPrice:0,totalDiscount:0}}function g(){return{getItem:C,setItem:I,setSize:K,addAdditive:h,removeAdditive:q,clear:F}}const{setSize:B}=g();function U(e){const s=document.querySelector("#modal-sizes");if(!(s instanceof HTMLDivElement))throw new Error("can not find sizes div");const c=t=>{const r=t.target;if(!(r instanceof Element))return;const i=r.closest("button.tab-size");if(!(i instanceof HTMLButtonElement))return;s.querySelectorAll(".tab-size").forEach(l=>l.classList.remove("active")),i.classList.add("active");const o=i.getAttribute("data-price")??"",a=i.getAttribute("data-discount")||o||"0",d=i.getAttribute("data-size-key")??"";B({size:d,price:o,discountPrice:a}),e()};return s.addEventListener("click",c),()=>{s.removeEventListener("click",c)}}const{addAdditive:G}=g();function J(e){const s=document.querySelector("#modal-additives");if(!(s instanceof HTMLDivElement))throw new Error("can not find additives div");const c=t=>{const r=t.target;if(!(r instanceof Element))return;const i=r.closest("button.tab-add");if(!(i instanceof HTMLButtonElement))return;i.classList.toggle("active");const o=i.getAttribute("data-add-price")??"0",a=i.getAttribute("data-add-discount")||o||"0",d=i.getAttribute("data-add-key")??"";G({name:d,price:o,discountPrice:a}),e()};return s.addEventListener("click",c),()=>s.removeEventListener("click",c)}const{isLoggedIn:Q}=E(),{getItem:u,setSize:R,setItem:V}=g(),{addItem:W}=T(),p=document.querySelector("#modal"),x=document.querySelector(".window"),$=document.querySelector("#close-modal"),y=document.querySelector("#modal-img"),P=document.querySelector("#modal-title"),D=document.querySelector("#modal-description"),S=document.querySelector("#add-to-cart"),m=document.querySelector("#error");let v=null,b=null;function L(){p?.classList.add("hidden"),document.body.style.overflow="auto",v&&v(),b&&b()}$?.addEventListener("click",()=>{L()});S?.addEventListener("click",()=>{const e={productId:u().productId,name:u().name,size:u().sizeKey,additives:u().addKeys,quantity:1,priceOld:u().totalPrice,priceNew:u().totalPrice-u().totalDiscount};W(e),w(),L()});window.addEventListener("click",e=>{e.target===p&&e.target!==x&&L()});window.addEventListener("keydown",e=>{e.key==="Escape"&&L()});function z(){const e=u().totalPrice,s=u().totalDiscount,c=document.querySelector("#modal-price"),t=document.querySelector("#modal-discount");!(c instanceof HTMLHeadingElement)||!(t instanceof HTMLHeadingElement)||(Q()?s===e?(c.classList.add("hidden"),t.textContent=`$${Number(e).toFixed(2)}`):(c.classList.remove("hidden"),c.textContent=`$${Number(e).toFixed(2)}`,t.textContent=`$${Number(s).toFixed(2)}`):(c.classList.add("hidden"),t.textContent=`$${Number(e).toFixed(2)}`))}async function O(e){m&&(m.style.display="none");const{data:s,error:c}=await M(`https://6kt29kkeub.execute-api.eu-central-1.amazonaws.com/products/${e}`,"#loader");if(c){m&&(m.style.display="block");return}if(!s?.data)throw new Error("Product not found");V({productId:e,name:s.data.name});const t=s.data;if(!(p instanceof HTMLDivElement)||!(x instanceof HTMLDivElement)||!($ instanceof HTMLButtonElement)||!(y instanceof HTMLImageElement)||!(P instanceof HTMLHeadingElement)||!(D instanceof HTMLParagraphElement)||!(S instanceof HTMLButtonElement))throw new Error("Modal elements not found");p.classList.remove("hidden"),document.body.style.overflow="hidden",y.src=`images/menu/${t.id}.png`,y.alt=t.name,P.textContent=t.name,D.textContent=t.description,k(t),N(t),b=U(z),v=J(z),R({size:t.sizes[Object.keys(t.sizes)[0]].size,price:t.sizes[Object.keys(t.sizes)[0]].price,discountPrice:t.sizes[Object.keys(t.sizes)[0]].discountPrice||t.sizes[Object.keys(t.sizes)[0]].price||"0"}),z()}export{O as displayModal};
//# sourceMappingURL=modal-B-3Owjd_.js.map
