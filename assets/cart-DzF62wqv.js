import{u as d,a as T}from"./addCartIcon-BIPM-ezy.js";import{u as $}from"./userState-Ciub17Fa.js";import{a as b,d as D,c as N,u as q,e as I,o as O}from"./firebase-CxVZMhw8.js";import{l as P}from"./user-Bdg1Tj1F.js";import"./auth-DGodpPl6.js";const{isLoggedIn:_}=$(),{getTotalPriceNew:w,getTotalPriceOld:m}=d(),f=document.querySelector("#total-price-old"),g=document.querySelector("#total-price-new");function H(){if(!(f instanceof HTMLHeadingElement)||!(g instanceof HTMLHeadingElement))throw new Error("Cart elements not found");_()?(m()===w()?f.classList.add("hidden"):f.classList.remove("hidden"),f.textContent=`$${m().toFixed(2)}`,g.textContent=`$${(m()-w()).toFixed(2)}`):g.textContent=`$${m().toFixed(2)}`}const{isLoggedIn:U}=$(),{getCart:F}=d();function M(r){const e=document.querySelector("#cart-list");if(!(e instanceof HTMLUListElement))throw new Error("Cart elements not found");const n=F();e.innerHTML="",n.forEach(t=>{for(let o=0;o<t.quantity;o++){const s=document.createElement("li");s.classList.add("cart-item");const a=document.createElement("button");a.setAttribute("data-id",t.productId.toString()),a.classList.add("btn-icon"),a.type="button",a.innerHTML='<i class="fa-solid fa-trash"></i>',a.addEventListener("click",r);const c=document.createElement("img");c.classList.add("cart-item_img"),c.src=`/images/menu/${t.productId}.png`,c.alt=t.name;const l=document.createElement("div");l.classList.add("cart-item_info");const p=document.createElement("h3");p.classList.add("cart-item_name"),p.textContent=t.name;const y=document.createElement("p"),L=document.createElement("span");L.classList.add("cart-item_size"),L.textContent=t.size;const h=document.createElement("span");h.classList.add("cart-item_additives"),h.textContent=t.additives.length?t.additives.map(i=>`, ${i}`).join(""):"",y.append(L,h),l.append(p,y);const u=document.createElement("div");if(u.classList.add("price-container"),U()){const i=document.createElement("h3");i.classList.add("price__old"),i.textContent=`$${t.priceOld.toFixed(2)}`;const v=document.createElement("h3");v.textContent=`$${(t.priceOld-t.priceNew).toFixed(2)}`,u.append(i,v)}else{const i=document.createElement("h3");i.classList.add("price__new"),i.textContent=`$${t.priceOld.toFixed(2)}`,u.append(i)}s.append(a,c,l,u),e?.append(s)}}),H(),T()}const{getTotalCount:A}=d();function C(){const r=document.querySelector("#confirm");if(r)if(A()>0){r.disabled=!1,r.classList.remove("disabled");return}else{r.disabled=!0,r.classList.add("disabled");return}}const{getCart:B,setCart:k}=d(),x=r=>{const e=r.target;if(!(e instanceof Element))return;const n=e.closest("button[data-id]");if(!n)return;const t=n.getAttribute("data-id");if(!t)return;const o=Number(t),s=B(),a=s.findIndex(l=>l.productId===o);if(a===-1)return;const c=[...s];c[a].quantity>1?c[a]={...c[a],quantity:c[a].quantity-1}:c.splice(a,1),k(c),C(),M(x)},{clear:z}=d(),R=async r=>{const e=b.currentUser;if(!e){console.error("User not authenticated");return}const n=document.querySelector("#error"),t=document.querySelector("#cart-list");if(!(n instanceof HTMLHeadingElement)||!(t instanceof HTMLUListElement))throw new Error("Elements not found");try{n.classList.add("hidden");const o=D(N,"users",e.uid);await q(o,{orders:I({...r,createdAt:new Date().toISOString()})}),z(),t&&(t.innerHTML=`<h3 id="message" class="message">
              Thank you for your order! Our manager will contact you shortly.
            </h3>`),n&&n.classList.add("hidden"),T(),H(),C()}catch(o){console.error("Error saving order:",o),n?.classList.remove("hidden")}},{getTotalPriceOld:j,getTotalPriceNew:G,getCart:J}=d(),E=document.querySelector(".buttons"),S=document.querySelector("#cart-total");if(!(E instanceof HTMLDivElement)||!(S instanceof HTMLDivElement))throw new Error("Cart list not found");const K=j()-G(),Q=J(),V=Q.map(({productId:r,name:e,size:n,additives:t,quantity:o})=>({productId:r,name:e,size:n,additives:t,quantity:o})),W={items:V,totalPrice:K};O(b,async r=>{if(r){const e=await P();if(!e){console.error("No user data found in Firestore");return}const n=document.createElement("div");n.classList.add("cart-row"),n.innerHTML=`<h3>Name:</h3>
                      <h3>${e.login}</h3>`;const t=document.createElement("div");t.classList.add("cart-row"),t.innerHTML=`<h3>Address:</h3>
                      <h3>${e.city}, ${e.street}, ${e.houseNumber}</h3>`;const o=document.createElement("div");o.classList.add("cart-row"),o.innerHTML=`<h3>Pay by:</h3>
                      <h3>${e.paymentMethod.charAt(0).toUpperCase()+e.paymentMethod.slice(1)}</h3>`,S.append(n,t,o);const s=document.createElement("button");s.classList.add("btn"),s.id="confirm",s.type="button",s.innerHTML="Confirm",E.appendChild(s),C(),s.addEventListener("click",()=>{R(W)})}else{const e=document.createElement("a");e.classList.add("btn"),e.innerHTML="Login",e.href="login";const n=document.createElement("a");n.classList.add("btn"),n.innerHTML="Registration",n.href="registration",E.append(e,n)}});M(x);
//# sourceMappingURL=cart-DzF62wqv.js.map
