import{u as y,a as S}from"./addCartIcon-y838yzLs.js";import{u as $}from"./userState-BenL3nAi.js";import{f as v}from"./fetcher-IzjmCLXP.js";const{isLoggedIn:q}=$(),{getCart:I,getTotalPriceNew:P,getTotalPriceOld:E}=y();function b(n){const e=document.querySelector("#cart-list"),o=document.querySelector("#total-price-old"),r=document.querySelector("#total-price-new");if(!(e instanceof HTMLUListElement)||!(o instanceof HTMLHeadingElement)||!(r instanceof HTMLHeadingElement))throw new Error("Cart elements not found");const i=I();e.innerHTML="",i.forEach(t=>{for(let c=0;c<t.quantity;c++){const a=document.createElement("li");a.classList.add("cart-item");const s=document.createElement("button");s.setAttribute("data-id",t.productId.toString()),s.classList.add("btn-icon"),s.type="button",s.innerHTML='<img src="icons/trash.svg" alt="trash icon" />',s.addEventListener("click",n);const u=document.createElement("img");u.classList.add("cart-item_img"),u.src=`/images/menu/${t.productId}.png`,u.alt=t.name;const f=document.createElement("div");f.classList.add("cart-item_info");const L=document.createElement("h3");L.classList.add("cart-item_name"),L.textContent=t.name;const C=document.createElement("p"),g=document.createElement("span");g.classList.add("cart-item_size"),g.textContent=t.size;const h=document.createElement("span");h.classList.add("cart-item_additives"),h.textContent=t.additives.join(", "),C.append(g,h),f.append(L,C);const p=document.createElement("div");if(p.classList.add("price-container"),q()){const d=document.createElement("h3");d.classList.add("price__old"),d.textContent=`$${t.priceOld.toFixed(2)}`;const T=document.createElement("h3");T.textContent=`$${(t.priceOld-t.priceNew).toFixed(2)}`,o.textContent=`$${E().toFixed(2)}`,r.textContent=`$${(E()-P()).toFixed(2)}`,p.append(d,T)}else{const d=document.createElement("h3");d.classList.add("price__new"),d.textContent=`$${t.priceOld.toFixed(2)}`,r.textContent=`$${E().toFixed(2)}`,p.append(d)}a.append(s,u,f,p),e?.append(a)}}),S()}const{getCart:k,setCart:N}=y(),x=n=>{const e=n.target;if(!(e instanceof Element))return;const o=e.closest("button[data-id]");if(!o)return;const r=o.getAttribute("data-id");if(!r)return;const i=Number(r),t=k(),c=t.findIndex(s=>s.productId===i);if(c===-1)return;const a=[...t];a[c].quantity>1?a[c]={...a[c],quantity:a[c].quantity-1}:a.splice(c,1),N(a),b(x)},{getCart:O,getTotalPriceNew:D,getTotalPriceOld:_,clear:z}=y(),A=_()-D(),F=O(),B=F.map(({productId:n,size:e,additives:o,quantity:r})=>({productId:n,size:e,additives:o,quantity:r})),U={items:B,totalPrice:A},l=document.querySelector("#error"),w=document.querySelector("#cart-list");if(!(l instanceof HTMLHeadingElement)||!(w instanceof HTMLUListElement))throw new Error("Elements not found");const j=async()=>{l.classList.add("hidden");const{data:n,error:e}=await v("https://6kt29kkeub.execute-api.eu-central-1.amazonaws.com/orders/confirm","#loader",{method:"POST",body:U});if(e){l&&l.classList.remove("hidden");return}n&&(z(),w&&(w.innerHTML=`            <h3 id="message" class="message">
              Thank you for your order! Our manager will contact you shortly.
            </h3>`),l&&l.classList.add("hidden"))},{isLoggedIn:H,getToken:R}=$(),m=document.querySelector(".buttons"),M=document.querySelector("#cart-total");if(!(m instanceof HTMLDivElement)||!(M instanceof HTMLDivElement))throw new Error("Cart list not found");if(H()){const{data:n,error:e}=await v("https://6kt29kkeub.execute-api.eu-central-1.amazonaws.com/auth/profile","#loader",{headers:{Accept:"application/json",Authorization:`Bearer ${R()}`}});e&&m&&(m.innerHTML="error");const o=n?.data;if(!o)throw new Error("User not found");const r=document.createElement("div");r.classList.add("cart-row"),r.innerHTML=`<h3>Address:</h3>
                      <h3>${o.city}, ${o.street}, ${o.houseNumber}</h3>`;const i=document.createElement("div");i.classList.add("cart-row"),i.innerHTML=`<h3>Pay by:</h3>
                      <h3>${o.paymentMethod.charAt(0).toUpperCase()+o.paymentMethod.slice(1)}</h3>`,M.append(r,i);const t=document.createElement("button");t.classList.add("btn"),t.type="button",t.innerHTML="Confirm",m.appendChild(t),t.addEventListener("click",j)}if(!H()){const n=document.createElement("a");n.classList.add("btn"),n.innerHTML="Login",n.href="login";const e=document.createElement("a");e.classList.add("btn"),e.innerHTML="Registration",e.href="registration",m.append(n,e)}b(x);
//# sourceMappingURL=cart-Cc34ka-W.js.map
